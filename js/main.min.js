"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function setup(){loadInformedConsent(),loadDebrief(),loadOtherProfiles(),setupStates(),startUnloadPrevention(),showState("informed_consent"),console.log("finished")}function startUnloadPrevention(){window.onbeforeunload=function(a){var b="All unsaved data will be lost when you leave the page.";return a.returnValue=b,b}}function stopUnloadPrevention(){window.onbeforeunload=void 0}function loadInformedConsent(){$("#informed_consent_text").load("resources/informed_consent.html")}function loadDebrief(){$("#debrief_text").load("resources/debrief.html")}function loadOtherProfiles(){var a=$("#player_selection_bar")[0];src_profiles.forEach(function(b){var c=document.createElement("div"),d="resources/profiles/"+b.image,f=document.createElement("img");f.src=d,f.style.display="block",f.style.width="100px",f.style.height="100px",f.style.cursor="pointer",c.appendChild(f),a.appendChild(c)})}function loadProfilePicture(a){var b=new FileReader;b.onload=function(c){$("#profile_picture").attr("src",c.target.result)},b.readAsDataURL(a.files[0])}function changeIdText(a,b){document.getElementById(a).innerHTML=b}function showIdElements(a){showElements($("#"+a))}function hideIdElements(a){hideElements($("#"+a))}function hideElements(a){a.css("display","none")}function showElements(a){a.css("display","block")}function removeAllSubElements(a){for(;a.firstChild;)a.removeChild(a.firstChild)}var State=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"show",value:function show(){}},{key:"hide",value:function hide(){}}]),a}(),SimpleState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.elements=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){showElements(this.elements)}},{key:"hide",value:function hide(){hideElements(this.elements)}}]),b}(State),InformedConsentPageState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){showIdElements("informed_consent_page"),$("#informed_consent_continue")[0].onclick=this.onNextClick.bind(this)}},{key:"hide",value:function hide(){hideIdElements("informed_consent_page"),hideIdElements("informed_consent_warning")}},{key:"onNextClick",value:function onNextClick(){this.allChecked()?showState(this.nextState):showIdElements("informed_consent_warning")}},{key:"allChecked",value:function allChecked(){for(var c=$(".informed_consent_check"),d=0;d<c.length;d++)if(!c[d].checked)return!1;return!0}}]),b}(State),CreateProfileState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.formElements=[$("#profile_form_image"),$("#profile_form_occupation"),$("#profile_form_hobbies"),$("#profile_form_three_words"),$("#profile_form_description")],d.backButton=$("#profile_back")[0],d.nextButton=$("#profile_next")[0],d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){this.section=1,showIdElements("create_profile_page"),this.backButton.onclick=this.onBackClick.bind(this),this.nextButton.onclick=this.onNextClick.bind(this),this.updatePage()}},{key:"hide",value:function hide(){hideIdElements("create_profile_page")}},{key:"updatePage",value:function updatePage(){this.updateInputFields(),this.updateSectionText(),this.updateButtons()}},{key:"updateInputFields",value:function updateInputFields(){for(var c=0;c<this.formElements.length;c++)c<this.section?showElements(this.formElements[c]):hideElements(this.formElements[c]),this.formElements[c].find("input, textarea")[0].disabled=c<this.section-1}},{key:"updateSectionText",value:function updateSectionText(){$("#profile_section_header")[0].innerHTML="Section "+this.section+"/"+this.formElements.length}},{key:"updateButtons",value:function updateButtons(){this.backButton.disabled=1>=this.section,this.nextButton.innerHTML=this.section==this.formElements.length?"Go to game":"Next"}},{key:"onNextClick",value:function onNextClick(){this.section<this.formElements.length?(this.section++,this.updatePage()):showState(this.nextState)}},{key:"onBackClick",value:function onBackClick(){1<this.section&&(this.section--,this.updatePage())}}]),b}(State),ConnectWithPlayersState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var g=this;showIdElements("page_connect");for(var c=src_profiles.length,d=0,f=0;f<=c;f++)window.setTimeout(function(h){changeIdText("connect_amount",h+" players found...")},d,f),d+=2e3*Math.random();window.setTimeout(function(){showState(g.nextState)},d+2e3)}},{key:"hide",value:function hide(){hideIdElements("page_connect")}}]),b}(State),SelectPlayerState=function(a){function b(c,d){_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.playersNeeded=c,f.selectionAmount=0,f.imageElements=$("#player_selection_bar img").toArray(),f.nextState=d,f}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("select_players_page"),this.imageElements.forEach(function(d,f){d.onclick=c.toggleSelection.bind(c,f),d.onmouseover=c.onMouseOverImage.bind(c,f),c.deselect(f)}),$("#select_players_start")[0].onclick=this.startGame.bind(this),this.selectionAmount=0,this.showDetailsOf(0),this.updatePage()}},{key:"hide",value:function hide(){hideIdElements("select_players_page")}},{key:"startGame",value:function startGame(){showState(this.nextState)}},{key:"onMouseOverImage",value:function onMouseOverImage(c){this.showDetailsOf(c)}},{key:"showDetailsOf",value:function showDetailsOf(c){var d=src_profiles[c];changeIdText("selected_player_occupation",d.occupation),changeIdText("selected_player_hobbies",d.hobbies),changeIdText("selected_player_three_words",d.threeWords),changeIdText("selected_player_description",d.description)}},{key:"toggleSelection",value:function toggleSelection(c){this.isSelected(c)?this.deselect(c):this.select(c),this.updatePage()}},{key:"isSelected",value:function isSelected(c){return jQuery(this.imageElements[c]).hasClass("selectedBox")}},{key:"select",value:function select(c){this.isSelected(c)||this.selectionAmount++,jQuery(this.imageElements[c]).removeClass("notSelectedBox"),jQuery(this.imageElements[c]).addClass("selectedBox")}},{key:"deselect",value:function deselect(c){this.isSelected(c)&&this.selectionAmount--,jQuery(this.imageElements[c]).removeClass("selectedBox"),jQuery(this.imageElements[c]).addClass("notSelectedBox")}},{key:"updatePage",value:function updatePage(){this.updateSelectionAmount(),this.updateStartButton()}},{key:"updateSelectionAmount",value:function updateSelectionAmount(){changeIdText("select_players_amount",this.selectionAmount+" of "+this.playersNeeded+" selected"),this.selectionAmount<this.playersNeeded?changeIdText("select_players_command","Please select more people."):this.selectionAmount==this.playersNeeded?changeIdText("select_players_command","Perfect, you can now start the game."):changeIdText("select_players_command","You have selected to many people. Please deselect someone.")}},{key:"updateStartButton",value:function updateStartButton(){$("#select_players_start")[0].disabled=this.selectionAmount!=this.playersNeeded}}]),b}(State),CalculatePlayersState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("calculate_players_page"),window.setTimeout(function(){showState(c.nextState)},3e3)}},{key:"hide",value:function hide(){hideIdElements("calculate_players_page")}}]),b}(State),NotChosenState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("not_chosen_page"),$("#not_chosen_next")[0].onclick=function(){showState(c.nextState)}}},{key:"hide",value:function hide(){hideIdElements("not_chosen_page")}}]),b}(State),NotChosenVideoState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("not_chosen_video_page"),$("#not_chosen_next_video")[0].onclick=function(){showState(c.nextState)}}},{key:"hide",value:function hide(){hideIdElements("not_chosen_video_page")}}]),b}(State),ShowVideoState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d.video=$("#game_video")[0],d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("game_video_page"),this.video.currentTime=0,this.video.play(),this.video.addEventListener("ended",function(){showState(c.nextState)},!1),this.video.onclick=function(d){(d.ctrlKey||d.altKey)&&showState(c.nextState)}}},{key:"hide",value:function hide(){hideIdElements("game_video_page"),this.video.pause()}}]),b}(State),CannotContinueState=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.nextState=c,d}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){var c=this;showIdElements("cannot_continue_page"),$("#cannot_continue_next")[0].onclick=function(){showState(c.nextState)}}},{key:"hide",value:function hide(){hideIdElements("cannot_continue_page")}}]),b}(State),DebriefState=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this))}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){showIdElements("debrief_page"),stopUnloadPrevention(),sendResultsToServer()}},{key:"hide",value:function hide(){hideIdElements("debrief_page")}}]),b}(State),QuestionsState=function(a){function b(c,d){_classCallCheck(this,b);var g=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.questions=c,g.questionIndex=0,g.inputElements=[],g.nextState=d,g.skipped=!1,g.answers=[];for(var f=0;f<c.length;f++)g.answers.push(null);return g}return _inherits(b,a),_createClass(b,[{key:"show",value:function show(){showIdElements("questions_page"),$("#questions_back")[0].onclick=this.onBackClick.bind(this),$("#questions_next")[0].onclick=this.onNextClick.bind(this),this.updateQuestion()}},{key:"hide",value:function hide(){hideIdElements("questions_page")}},{key:"getQuestionResults",value:function getQuestionResults(){for(var c={},d=0;d<this.questions.length;d++){var f=this.questions.get(d),g=this.questions.getGroupName(d),h=this.answers[d];g in c||(c[g]={}),c[g][f.question]=h}return c}},{key:"updateQuestion",value:function updateQuestion(){var c=this.getCurrentQuestionData(),d=c.question,f=c.answers,g=c.multiple;$("#questions_question")[0].innerHTML=d;var h=$("#questions_answers")[0];removeAllSubElements(h),this.inputElements=[];for(var j=0;j<f.length;j++){var k=f[j],l="answer_"+k,m=document.createElement("input");m.type=g?"checkbox":"radio",m.id=l,m.name=d,m.value=k;var n=document.createElement("label");n.setAttribute("for",l),n.innerHTML=" "+k;var o=document.createElement("div");o.appendChild(m),o.appendChild(n),h.appendChild(o),this.inputElements.push(m)}this.restoreCurrentAnswer(),this.updateButtons(),this.updateQuestionCounter()}},{key:"onNextClick",value:function onNextClick(c){(c.ctrlKey||c.altKey)&&(this.skipped=!0,showState(this.nextState)),null===this.getCurrentAnswer()||(this.storeCurrentAnswer(),this.questionIndex+1>=this.questions.length?showState(this.nextState):(this.questionIndex++,this.updateQuestion()))}},{key:"onBackClick",value:function onBackClick(){this.storeCurrentAnswer(),0<this.questionIndex&&(this.questionIndex--,this.updateQuestion())}},{key:"getCurrentQuestionData",value:function getCurrentQuestionData(){return this.questions.get(this.questionIndex)}},{key:"getCurrentAnswer",value:function getCurrentAnswer(){var c=null,d=this.getCurrentQuestionData();return d.multiple?(c=[],this.inputElements.forEach(function(f){f.checked&&c.push(f.value)})):this.inputElements.forEach(function(f){f.checked&&(c=f.value)}),c}},{key:"restoreCurrentAnswer",value:function restoreCurrentAnswer(){var c=this.answers[this.questionIndex];if(void 0!==c){var d=this.getCurrentQuestionData();d.multiple?this.inputElements.forEach(function(f){f.checked=0<=$.inArray(f.value,c)}):this.inputElements.forEach(function(f){f.checked=f.value==c})}}},{key:"storeCurrentAnswer",value:function storeCurrentAnswer(){this.answers[this.questionIndex]=this.getCurrentAnswer()}},{key:"updateButtons",value:function updateButtons(){var c=$("#questions_back")[0],d=$("#questions_next")[0],f=this.questionIndex;c.disabled=0===f,d.innerHTML=f<this.questions.length-1?"Next":"Finish Questions"}},{key:"updateQuestionCounter",value:function updateQuestionCounter(){changeIdText("question_counter","Question "+(this.questionIndex+1)+" of "+this.questions.length)}}]),b}(State),Question=function a(b,c){var d=2<arguments.length&&arguments[2]!==void 0&&arguments[2];_classCallCheck(this,a),this.question=b,this.answers=c,this.multiple=d,Object.freeze(this)},controlQuestions1=[];src_controlQuestions1.forEach(function(a){controlQuestions1.push(new Question(a.question,a.answers,a.multiple))});var controlQuestions2=[];src_controlQuestions2.forEach(function(a){controlQuestions2.push(new Question(a.question,a.answers,a.multiple))});var smdScaleQuestions=[];src_smdScale.forEach(function(a){smdScaleQuestions.push(new Question("During the last year you "+a,["yes","no"]))});var lonelinessQuestions=[];src_lonelinessScale.forEach(function(a){lonelinessQuestions.push(new Question(a,["Never","Rarely","Sometimes","Often"]))});var panasQuestions=[];src_panasScale.forEach(function(a){panasQuestions.push(new Question("How much do you currently feel: "+a,["Very slightly or not at all","A little","Moderately","Quite a bit","Extremely"]))});var QuestionSet=function(){function a(){_classCallCheck(this,a),this.questions=[],this.groupNames=[]}return _createClass(a,[{key:"insertQuestions",value:function insertQuestions(b,c){var d=this;b.forEach(function(f){d.questions.push(f),d.groupNames.push(c)})}},{key:"get",value:function get(b){return this.questions[b]}},{key:"getGroupName",value:function getGroupName(b){return this.groupNames[b]}},{key:"length",get:function get(){return this.questions.length}}]),a}(),firstQuestionSet=new QuestionSet;firstQuestionSet.insertQuestions(controlQuestions1,"Control Q1"),firstQuestionSet.insertQuestions(smdScaleQuestions,"SMD"),firstQuestionSet.insertQuestions(controlQuestions2,"Control Q2"),firstQuestionSet.insertQuestions(lonelinessQuestions,"Loneliness"),firstQuestionSet.insertQuestions(panasQuestions,"Panas");function getPanasQuestionsSet(a){var b=new QuestionSet;return b.insertQuestions(panasQuestions,"Panas"+a),b}var states;function setupStates(){states={informed_consent:new InformedConsentPageState("welcome_1"),welcome_1:new SimpleState($("#welcome_page_1")),welcome_2:new SimpleState($("#welcome_page_2")),welcome_3:new SimpleState($("#welcome_page_3")),before_start:new SimpleState($("#before_start_page")),questions_beginning:new QuestionsState(firstQuestionSet,"create_profile"),create_profile:new CreateProfileState("connect"),connect:new ConnectWithPlayersState("player_selection_1"),player_selection_1:new SelectPlayerState(5,"calculate_players_1"),calculate_players_1:new CalculatePlayersState("not_chosen_1"),not_chosen_1:new NotChosenState("questions_panas_1"),questions_panas_1:new QuestionsState(getPanasQuestionsSet(1),"player_selection_2"),player_selection_2:new SelectPlayerState(3,"calculate_players_2"),calculate_players_2:new CalculatePlayersState("not_chosen_2"),not_chosen_2:new NotChosenVideoState("show_video_2"),show_video_2:new ShowVideoState("player_selection_3"),player_selection_3:new SelectPlayerState(4,"calculate_players_3"),calculate_players_3:new CalculatePlayersState("not_chosen_3"),not_chosen_3:new NotChosenState("questions_panas_3"),questions_panas_3:new QuestionsState(getPanasQuestionsSet(3),"player_selection_4"),player_selection_4:new SelectPlayerState(2,"calculate_players_4"),calculate_players_4:new CalculatePlayersState("cannot_continue_4"),cannot_continue_4:new CannotContinueState("questions_panas_4"),questions_panas_4:new QuestionsState(getPanasQuestionsSet(4),"debrief"),debrief:new DebriefState}}function showState(a){hideAllStates(),states[a].show()}function hideAllStates(){for(var a in states)Object.prototype.hasOwnProperty.call(states,a)&&states[a].hide()}function getQuestionResultsJson(){return JSON.stringify(getAllQuestionResults())}function getAllQuestionResults(){for(var a={},b=getAllQuestionStates(),c=0;c<b.length;c++){var d=b[c],f=d.getQuestionResults();for(var g in f)f.hasOwnProperty(g)&&(a[g]=f[g])}return a}function userSkippedAtSomePoint(){for(var a=getAllQuestionStates(),b=0;b<a.length;b++)if(a[b].skipped)return!0;return!1}function getAllQuestionStates(){var a=[];for(var b in states)if(states.hasOwnProperty(b)){var c=states[b];c instanceof QuestionsState&&a.push(c)}return a}function sendResultsToServer(){$.post("./store.php",getQuestionResultsJson(),function(b){console.log(b)})}
